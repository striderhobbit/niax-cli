<div class="content" *ngIf="resourceTable">
  <form
    (change)="fetchResourceTableColumns(resourceTable)"
    #form="ngForm"
    class="table-columns"
  >
    <table>
      <thead>
        <tr>
          <th>path</th>
          <th>include</th>
          <th>primaryPath</th>
          <th>order</th>
          <th>filter</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="
            let column of resourceTable.columns | keyvalue : preserveOrder
          "
        >
          <td>{{ column.key }}</td>
          <td>
            <input
              [(ngModel)]="column.value.include"
              name="include-{{ column.key }}-checkbox"
              type="checkbox"
            />
          </td>
          <td>
            <input
              (ngModelChange)="
                onPrimaryPathToggled(resourceTable, {
                  item: column.value.path,
                  state: $event
                })
              "
              [ngModel]="
                resourceTable.$primaryPaths.includes(column.value.path)
              "
              name="primary-path-{{ column.key }}-checkbox"
              type="checkbox"
            />
          </td>
          <td>
            <select
              [(ngModel)]="column.value.order"
              name="order-{{ column.key }}-select"
            >
              <option>asc</option>
              <option>desc</option>
            </select>
          </td>
          <td>
            <input
              (ngModelChange)="form.invalid || (column.value.filter = $event)"
              [ngModel]="column.value.filter"
              name="filter-{{ column.key }}-text"
              pattern="[^,]*"
              type="text"
            />
          </td>
        </tr>
      </tbody>
    </table>
    <div
      (cdkDropListDropped)="
        onPrimaryPathDropped(resourceTable, $event);
        fetchResourceTableColumns(resourceTable)
      "
      [cdkDropListData]="resourceTable.$primaryPaths"
      cdkDropList
      class="primary-paths"
    >
      <div
        *ngFor="let primaryPath of resourceTable.$primaryPaths"
        [cdkDragData]="primaryPath"
        cdkDrag
      >
        {{ primaryPath }}
      </div>
    </div>
  </form>
  <table>
    <thead>
      <tr>
        <th
          *ngFor="
            let column of resourceTable.columns
              | keyvalue : preserveOrder
              | filter : 'value.include'
          "
        >
          {{ column.key }}
        </th>
      </tr>
    </thead>
    <tbody
      *ngFor="
        let rowsPage of resourceTable.rowsPages | keyvalue : preserveOrder
      "
    >
      <tr
        *ngIf="
          !rowsPage.value.items && isConnected(resourceTable, rowsPage.value)
        "
        (intersection)="fetchResourceTableRows(resourceTable, rowsPage.key)"
        observeIntersection
      >
        â‹¯
      </tr>
      <tr
        *ngFor="let row of rowsPage.value.items"
        (viewInit)="$event.scrollIntoView({ block: 'start' })"
        [viewInitIgnored]="row.resource.id !== resourceTable.query.resourceId"
        observeViewInit
      >
        <td
          *ngFor="let field of row.fields"
          [class.nullish]="field.value == null"
          [ngSwitch]="field.type"
        >
          <input
            *ngSwitchCase="'boolean'"
            (change)="patchResourceItem(resourceTable, field)"
            [(ngModel)]="field.value"
            type="checkbox"
          />
          <input
            *ngSwitchCase="'number'"
            (change)="patchResourceItem(resourceTable, field)"
            [(ngModel)]="field.value"
            type="number"
          />
          <input
            *ngSwitchCase="'string'"
            (change)="patchResourceItem(resourceTable, field)"
            [(ngModel)]="field.value"
            type="text"
          />
        </td>
      </tr>
    </tbody>
  </table>
</div>
