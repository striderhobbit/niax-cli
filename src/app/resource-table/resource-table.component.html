<div class="content" *ngIf="resourceTable">
  <form
    (change)="fetchResourceTableColumns(resourceTable)"
    #form="ngForm"
    class="table-columns"
  >
    <table>
      <thead>
        <tr>
          <th>path</th>
          <th>include</th>
          <th>primaryPath</th>
          <th>order</th>
          <th>filter</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let column of resourceTable.columns">
          <td>{{ column.path }}</td>
          <td>
            <input
              [(ngModel)]="column.include"
              name="include-{{ column.path }}-checkbox"
              type="checkbox"
            />
          </td>
          <td>
            <input
              (ngModelChange)="
                onPrimaryPathToggled(resourceTable, {
                  item: column.path,
                  state: $event
                })
              "
              [ngModel]="resourceTable.primaryPaths.includes(column.path)"
              name="primary-path-{{ column.path }}-checkbox"
              type="checkbox"
            />
          </td>
          <td>
            <select
              [(ngModel)]="column.order"
              name="order-{{ column.path }}-select"
            >
              <option>asc</option>
              <option>desc</option>
            </select>
          </td>
          <td>
            <input
              (ngModelChange)="form.invalid || (column.filter = $event)"
              [ngModel]="column.filter"
              name="filter-{{ column.path }}-text"
              pattern="[^,]*"
              type="text"
            />
          </td>
        </tr>
      </tbody>
    </table>
    <div
      (cdkDropListDropped)="
        onPrimaryPathDropped(resourceTable, $event);
        fetchResourceTableColumns(resourceTable)
      "
      [cdkDropListData]="resourceTable.primaryPaths"
      cdkDropList
      class="primary-paths"
    >
      <div
        *ngFor="let primaryPath of resourceTable.primaryPaths"
        [cdkDragData]="primaryPath"
        cdkDrag
      >
        {{ primaryPath }}
      </div>
    </div>
  </form>
  <table>
    <thead>
      <tr>
        <th *ngFor="let column of resourceTable.columns | filter : 'include'">
          {{ column.path }}
        </th>
      </tr>
    </thead>
    <tbody *ngFor="let rowsPage of resourceTable.rowsPages">
      <tr
        *ngIf="rowsPage.deferred && isConnected(resourceTable, rowsPage)"
        (intersection)="
          fetchResourceTableRows(resourceTable, rowsPage.pageToken)
        "
        observeIntersection
      >
        â‹¯
      </tr>
      <tr
        *ngFor="let row of rowsPage.items"
        (viewInit)="$event.scrollIntoView({ block: 'start' })"
        [viewInitIgnored]="row.resource.id !== resourceTable.resource.id"
        observeViewInit
      >
        <td
          *ngFor="let field of row.fields"
          [class.nullish]="field.value == null"
          [ngSwitch]="field.type"
        >
          <input
            *ngSwitchCase="'boolean'"
            (change)="patchResourceItem(resourceTable, field)"
            [(ngModel)]="field.value"
            type="checkbox"
          />
          <input
            *ngSwitchCase="'number'"
            (change)="patchResourceItem(resourceTable, field)"
            [(ngModel)]="field.value"
            type="number"
          />
          <input
            *ngSwitchCase="'string'"
            (change)="patchResourceItem(resourceTable, field)"
            [(ngModel)]="field.value"
            type="text"
          />
        </td>
      </tr>
    </tbody>
  </table>
</div>
